<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title>pagesetup.xsl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="source.css" type="text/css">
</head>
<body>
<h2>pagesetup.xsl</h2>

<table class="sourcetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138</pre></div></td><td class="code"><div class="source"><pre><a name="line-1"></a><span class="cp">&lt;?xml version=&#39;1.0&#39;?&gt;</span>
<a name="line-2"></a><span class="k">&lt;xsl:stylesheet</span> <span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
<a name="line-3"></a>                <span class="na">xmlns:exsl=</span><span class="s">&quot;http://exslt.org/common&quot;</span>
<a name="line-4"></a>                <span class="na">exclude-result-prefixes=</span><span class="s">&quot;exsl&quot;</span>
<a name="line-5"></a>                <span class="na">version=</span><span class="s">&#39;1.0&#39;</span><span class="nt">&gt;</span>
<a name="line-6"></a>
<a name="line-7"></a><span class="c">&lt;!--############################################################################</span>
<a name="line-8"></a><span class="c">    XSLT Stylesheet DocBook -&gt; LaTeX </span>
<a name="line-9"></a><span class="c">    ############################################################################</span>
<a name="line-10"></a><span class="c">    </span>
<a name="line-11"></a><span class="c">    This stylesheet allows to setup paper and page dimensions through some</span>
<a name="line-12"></a><span class="c">    predefined parameters. Most of the page setup parameters come from the</span>
<a name="line-13"></a><span class="c">    DocBook XSL FO parameters. The latex packages used to perform this setup</span>
<a name="line-14"></a><span class="c">    are the well known &#39;geometry&#39; and &#39;crop&#39;.</span>
<a name="line-15"></a>
<a name="line-16"></a><span class="c">    This feature has been sponsored by Freexian (http://www.freexian.com).</span>
<a name="line-17"></a><span class="c">    </span>
<a name="line-18"></a><span class="c">--&gt;</span>
<a name="line-19"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;page.height&quot;</span><span class="nt">/&gt;</span>
<a name="line-20"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;page.margin.bottom&quot;</span><span class="nt">/&gt;</span>
<a name="line-21"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;page.margin.inner&quot;</span><span class="nt">/&gt;</span>
<a name="line-22"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;page.margin.outer&quot;</span><span class="nt">/&gt;</span>
<a name="line-23"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;page.margin.top&quot;</span><span class="nt">/&gt;</span>
<a name="line-24"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;page.width&quot;</span><span class="nt">/&gt;</span>
<a name="line-25"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;paper.type&quot;</span><span class="nt">/&gt;</span>
<a name="line-26"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;geometry.options&quot;</span><span class="nt">/&gt;</span>
<a name="line-27"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;crop.marks&quot;</span> <span class="na">select=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<a name="line-28"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;crop.paper.type&quot;</span><span class="nt">/&gt;</span>
<a name="line-29"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;crop.page.width&quot;</span><span class="nt">/&gt;</span>
<a name="line-30"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;crop.page.height&quot;</span><span class="nt">/&gt;</span>
<a name="line-31"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;crop.mode&quot;</span> <span class="na">select=</span><span class="s">&quot;&#39;cam&#39;&quot;</span><span class="nt">/&gt;</span>
<a name="line-32"></a><span class="k">&lt;xsl:param</span> <span class="na">name=</span><span class="s">&quot;crop.options&quot;</span><span class="nt">/&gt;</span>
<a name="line-33"></a>
<a name="line-34"></a><span class="k">&lt;xsl:template</span> <span class="na">name=</span><span class="s">&quot;page.setup&quot;</span><span class="nt">&gt;</span>
<a name="line-35"></a>
<a name="line-36"></a>  <span class="k">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">&quot;geometry.setup&quot;</span><span class="nt">&gt;</span>
<a name="line-37"></a>    <span class="nt">&lt;geometry</span> <span class="na">paperwidth=</span><span class="s">&quot;{$page.width}&quot;</span>
<a name="line-38"></a>              <span class="na">paperheight=</span><span class="s">&quot;{$page.height}&quot;</span>
<a name="line-39"></a>              <span class="na">papername=</span><span class="s">&quot;{$paper.type}&quot;</span>
<a name="line-40"></a>              <span class="na">right=</span><span class="s">&quot;{$page.margin.outer}&quot;</span>
<a name="line-41"></a>              <span class="na">left=</span><span class="s">&quot;{$page.margin.inner}&quot;</span>
<a name="line-42"></a>              <span class="na">top=</span><span class="s">&quot;{$page.margin.top}&quot;</span>
<a name="line-43"></a>              <span class="na">bottom=</span><span class="s">&quot;{$page.margin.bottom}&quot;</span><span class="nt">/&gt;</span>
<a name="line-44"></a>  <span class="k">&lt;/xsl:variable&gt;</span>
<a name="line-45"></a>
<a name="line-46"></a>  <span class="k">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">&quot;geometry.params&quot;</span><span class="nt">&gt;</span>
<a name="line-47"></a>    <span class="k">&lt;xsl:for-each</span> <span class="na">select=</span><span class="s">&quot;exsl:node-set($geometry.setup)//@*&quot;</span><span class="nt">&gt;</span>
<a name="line-48"></a>      <span class="k">&lt;xsl:if</span> <span class="na">test=</span><span class="s">&quot;. != &#39;&#39;&quot;</span><span class="nt">&gt;</span>
<a name="line-49"></a>        <span class="k">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;local-name()&quot;</span><span class="nt">/&gt;</span>
<a name="line-50"></a>        <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>=<span class="k">&lt;/xsl:text&gt;</span>
<a name="line-51"></a>        <span class="k">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="nt">/&gt;</span>
<a name="line-52"></a>        <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>,<span class="k">&lt;/xsl:text&gt;</span>
<a name="line-53"></a>      <span class="k">&lt;/xsl:if&gt;</span>
<a name="line-54"></a>    <span class="k">&lt;/xsl:for-each&gt;</span>
<a name="line-55"></a>    <span class="k">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;$geometry.options&quot;</span><span class="nt">/&gt;</span>
<a name="line-56"></a>  <span class="k">&lt;/xsl:variable&gt;</span>
<a name="line-57"></a>
<a name="line-58"></a>  <span class="c">&lt;!-- The body includes the header and footer --&gt;</span>
<a name="line-59"></a>  <span class="k">&lt;xsl:if</span> <span class="na">test=</span><span class="s">&quot;$geometry.params != &#39;&#39;&quot;</span><span class="nt">&gt;</span>
<a name="line-60"></a>    <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>\usepackage[includeheadfoot,<span class="k">&lt;/xsl:text&gt;</span> 
<a name="line-61"></a>    <span class="k">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;$geometry.params&quot;</span><span class="nt">/&gt;</span>
<a name="line-62"></a>    <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>]{geometry}<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span> 
<a name="line-63"></a>  <span class="k">&lt;/xsl:if&gt;</span>
<a name="line-64"></a>
<a name="line-65"></a>  <span class="k">&lt;xsl:if</span> <span class="na">test=</span><span class="s">&quot;$crop.marks != 0&quot;</span><span class="nt">&gt;</span>
<a name="line-66"></a>    <span class="k">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">&quot;crop.params&quot;</span><span class="nt">&gt;</span>
<a name="line-67"></a>      <span class="k">&lt;xsl:choose</span><span class="nt">&gt;</span>
<a name="line-68"></a>      <span class="k">&lt;xsl:when</span> <span class="na">test=</span><span class="s">&quot;$crop.paper.type != &#39;&#39;&quot;</span><span class="nt">&gt;</span>
<a name="line-69"></a>        <span class="k">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;$crop.paper.type&quot;</span><span class="nt">/&gt;</span>
<a name="line-70"></a>        <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>,<span class="k">&lt;/xsl:text&gt;</span>
<a name="line-71"></a>      <span class="k">&lt;/xsl:when&gt;</span>
<a name="line-72"></a>      <span class="k">&lt;xsl:when</span> <span class="na">test=</span><span class="s">&quot;$crop.page.width != &#39;&#39; and</span>
<a name="line-73"></a><span class="s">                      $crop.page.height != &#39;&#39;&quot;</span><span class="nt">&gt;</span>
<a name="line-74"></a>        <span class="c">&lt;!-- No &#39;true&#39; length, assuming no scaling --&gt;</span>
<a name="line-75"></a>        <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>width=<span class="k">&lt;/xsl:text&gt;</span>
<a name="line-76"></a>        <span class="k">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;$crop.page.width&quot;</span><span class="nt">/&gt;</span>
<a name="line-77"></a>        <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>,<span class="k">&lt;/xsl:text&gt;</span>
<a name="line-78"></a>        <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>height=<span class="k">&lt;/xsl:text&gt;</span>
<a name="line-79"></a>        <span class="k">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;$crop.page.height&quot;</span><span class="nt">/&gt;</span>
<a name="line-80"></a>        <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>,<span class="k">&lt;/xsl:text&gt;</span>
<a name="line-81"></a>      <span class="k">&lt;/xsl:when&gt;</span>
<a name="line-82"></a>      <span class="k">&lt;xsl:otherwise</span><span class="nt">&gt;</span>
<a name="line-83"></a>        <span class="k">&lt;xsl:message</span><span class="nt">&gt;</span>
<a name="line-84"></a>          <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>Warning: crop required without crop size setup<span class="k">&lt;/xsl:text&gt;</span>
<a name="line-85"></a>        <span class="k">&lt;/xsl:message&gt;</span>
<a name="line-86"></a>      <span class="k">&lt;/xsl:otherwise&gt;</span>
<a name="line-87"></a>
<a name="line-88"></a>      <span class="c">&lt;!-- FIXME: find out how to use crop.margin. The following fails:</span>
<a name="line-89"></a><span class="c">      &lt;xsl:otherwise&gt;</span>
<a name="line-90"></a><span class="c">        &lt;xsl:text&gt;width=\pagewidth&lt;/xsl:text&gt;</span>
<a name="line-91"></a><span class="c">        &lt;xsl:text&gt;+&lt;/xsl:text&gt;</span>
<a name="line-92"></a><span class="c">        &lt;xsl:value-of select=&quot;$crop.margin&quot;/&gt;</span>
<a name="line-93"></a><span class="c">        &lt;xsl:text&gt;+&lt;/xsl:text&gt;</span>
<a name="line-94"></a><span class="c">        &lt;xsl:value-of select=&quot;$crop.margin&quot;/&gt;</span>
<a name="line-95"></a><span class="c">        &lt;xsl:text&gt;,&lt;/xsl:text&gt;</span>
<a name="line-96"></a><span class="c">        &lt;xsl:text&gt;height=\pageheight&lt;/xsl:text&gt;</span>
<a name="line-97"></a><span class="c">        &lt;xsl:text&gt;+&lt;/xsl:text&gt;</span>
<a name="line-98"></a><span class="c">        &lt;xsl:value-of select=&quot;$crop.margin&quot;/&gt;</span>
<a name="line-99"></a><span class="c">        &lt;xsl:text&gt;+&lt;/xsl:text&gt;</span>
<a name="line-100"></a><span class="c">        &lt;xsl:value-of select=&quot;$crop.margin&quot;/&gt;</span>
<a name="line-101"></a><span class="c">        &lt;xsl:text&gt;,&lt;/xsl:text&gt;</span>
<a name="line-102"></a><span class="c">      &lt;/xsl:otherwise&gt;</span>
<a name="line-103"></a><span class="c">      --&gt;</span>
<a name="line-104"></a>      <span class="k">&lt;/xsl:choose&gt;</span>
<a name="line-105"></a>      <span class="k">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;$crop.options&quot;</span><span class="nt">/&gt;</span>
<a name="line-106"></a>    <span class="k">&lt;/xsl:variable&gt;</span>
<a name="line-107"></a>
<a name="line-108"></a>    <span class="k">&lt;xsl:if</span> <span class="na">test=</span><span class="s">&quot;$crop.params != &#39;&#39;&quot;</span><span class="nt">&gt;</span>
<a name="line-109"></a>      <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>\usepackage[<span class="k">&lt;/xsl:text&gt;</span> 
<a name="line-110"></a>      <span class="k">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;$crop.params&quot;</span><span class="nt">/&gt;</span>
<a name="line-111"></a>      <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>center,<span class="k">&lt;/xsl:text&gt;</span>
<a name="line-112"></a>      <span class="k">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;$crop.mode&quot;</span><span class="nt">/&gt;</span>
<a name="line-113"></a>      <span class="k">&lt;xsl:text</span><span class="nt">&gt;</span>]{crop}<span class="ni">&amp;#10;</span><span class="k">&lt;/xsl:text&gt;</span> 
<a name="line-114"></a>    <span class="k">&lt;/xsl:if&gt;</span>
<a name="line-115"></a>  <span class="k">&lt;/xsl:if&gt;</span>
<a name="line-116"></a>
<a name="line-117"></a><span class="k">&lt;/xsl:template&gt;</span>
<a name="line-118"></a>
<a name="line-119"></a><span class="c">&lt;!-- Unit-test cases:</span>
<a name="line-120"></a><span class="c">     dblatex -P paper.type=a5paper</span>
<a name="line-121"></a><span class="c">             -P page.margin.outer=1cm</span>
<a name="line-122"></a><span class="c">             -P page.margin.inner=3cm pagesetup.xml</span>
<a name="line-123"></a>
<a name="line-124"></a><span class="c">     dblatex -P paper.type=a5paper</span>
<a name="line-125"></a><span class="c">             -P page.margin.outer=1cm</span>
<a name="line-126"></a><span class="c">             -P page.margin.inner=3cm</span>
<a name="line-127"></a><span class="c">             -P crop.marks=1</span>
<a name="line-128"></a><span class="c">             -P crop.paper.type=a4 pagesetup.xml</span>
<a name="line-129"></a>
<a name="line-130"></a><span class="c">     dblatex -P page.width=18.89cm</span>
<a name="line-131"></a><span class="c">             -P page.height=24.58cm</span>
<a name="line-132"></a><span class="c">             -P page.margin.outer=1cm</span>
<a name="line-133"></a><span class="c">             -P page.margin.inner=3cm</span>
<a name="line-134"></a><span class="c">             -P crop.marks=1 </span>
<a name="line-135"></a><span class="c">             -P crop.page.width=21cm</span>
<a name="line-136"></a><span class="c">             -P crop.page.height=29.7cm pagesetup.xml</span>
<a name="line-137"></a><span class="c">--&gt;</span>
<a name="line-138"></a><span class="k">&lt;/xsl:stylesheet&gt;</span>
</pre></div>
</td></tr></table></body>
</html>
